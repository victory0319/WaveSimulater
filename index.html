<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>파동 굴절 시뮬레이션</title>
    <style>
        body { 
            font-family: 'Malgun Gothic', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 10px; 
        }
        h1 { 
            margin-bottom: 10px; 
            font-size: 1.5em;
        }
        #controls { 
            margin-bottom: 15px; 
            padding: 10px; 
            border: 1px solid #333; 
        }
        .input-group { 
            margin-bottom: 5px; 
            display: flex; 
            align-items: center; 
        }
        label { 
            width: 150px; 
        }
        input[type="number"] { 
            padding: 3px; 
            border: 1px solid #333; 
            width: 60px; 
            text-align: right; 
        }
        button { 
            padding: 5px 10px; 
            background-color: #fff; 
            color: #333; 
            border: 1px solid #333; 
            cursor: pointer; 
            margin-top: 10px;
        }
        canvas { 
            border: 2px solid #000; 
            margin-top: 10px; 
            background-color: #fff; 
        }
        #results { 
            margin-top: 10px; 
            font-size: 1.0em; 
            border: none;
            padding: 0;
            line-height: 1.5;
        }
        .warning {
            color: orange;
        }
    </style>
</head>
<body>
    <h1>파동 굴절 시뮬레이션</h1>

    <div id="controls">
        <div class="input-group">
            <label for="n1">매질 1의 굴절률 (n1):</label>
            <input type="number" id="n1" value="1.00" step="0.01" min="1.0">
        </div>
        <div class="input-group">
            <label for="n2">매질 2의 굴절률 (n2):</label>
            <input type="number" id="n2" value="1.33" step="0.01" min="1.0">
        </div>
        <div class="input-group">
            <label for="angle1">입사각 :</label>
            <input type="number" id="angle1" value="30" step="1" min="0" max="90">
        </div>
        <button onclick="calculateAndDraw()">실행</button>
    </div>

    <canvas id="refractionCanvas" width="400" height="400"></canvas>
    
    <div id="results"></div>

    <script>
        const canvas = document.getElementById('refractionCanvas');
        const ctx = canvas.getContext('2d');
        const resultsDiv = document.getElementById('results');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const rayLength = 180; 

        function toRadians(degrees) {
            return degrees * (Math.PI / 180);
        }
        function toDegrees(radians) {
            return radians * (180 / Math.PI);
        }

        function calculateAndDraw() {
            const n1 = parseFloat(document.getElementById('n1').value);
            const n2 = parseFloat(document.getElementById('n2').value);
            const angle1Deg = parseFloat(document.getElementById('angle1').value);

            if (isNaN(n1) || isNaN(n2) || isNaN(angle1Deg) || angle1Deg < 0 || angle1Deg > 90) {
                resultsDiv.textContent = '유효한 값을 입력하세요.';
                return;
            }

            const angle1Rad = toRadians(angle1Deg);
            const sinTheta2 = (n1 / n2) * Math.sin(angle1Rad);

            let angle2Rad;
            let angle2Deg;
            let totalInternalReflection = false;
            let criticalAngleDeg = null;

            if (n1 > n2) {
                const criticalAngleRad = Math.asin(n2 / n1);
                criticalAngleDeg = toDegrees(criticalAngleRad);
            }

            if (n1 > n2 && angle1Deg > criticalAngleDeg) {
                totalInternalReflection = true;
                angle2Rad = angle1Rad;
                angle2Deg = angle1Deg;
                
                resultsDiv.innerHTML = `
                    입사각: ${angle1Deg.toFixed(1)}°<br>
                    <span class="warning">임계각 (${criticalAngleDeg.toFixed(1)}°) 초과</span><br>
                    전반사 발생<br>
                    반사각: ${angle2Deg.toFixed(1)}°
                `;
            } else {
                angle2Rad = Math.asin(sinTheta2);
                angle2Deg = toDegrees(angle2Rad);
                
                let criticalInfo = '';
                if (criticalAngleDeg !== null) {
                    criticalInfo = `임계각 : ${criticalAngleDeg.toFixed(1)}°<br>`;
                }

                resultsDiv.innerHTML = `
                    입사각: ${angle1Deg.toFixed(1)}°<br>
                    ${criticalInfo}
                    굴절각: ${angle2Deg.toFixed(1)}°
                `;
            }

            drawRefraction(n1, n2, angle1Rad, angle2Rad, totalInternalReflection);
        }

        function drawRefraction(n1, n2, angle1Rad, angle2Rad, totalInternalReflection) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#ffffff'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height); 

            ctx.font = '12px Arial';
            ctx.fillStyle = '#333';
            ctx.textAlign = 'center';
            ctx.fillText(`매질 1 (n₁=${n1.toFixed(2)})`, centerX / 2, centerY / 2);
            ctx.fillText(`매질 2 (n₂=${n2.toFixed(2)})`, centerX / 2, centerY + centerY / 2);

            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.stroke();
            ctx.setLineDash([]); 

            const incidentCanvasAngle = Math.PI / 2 - angle1Rad; 
            const incidentX = centerX - rayLength * Math.sin(angle1Rad); 
            const incidentY = centerY - rayLength * Math.cos(angle1Rad); 

            ctx.beginPath();
            ctx.moveTo(incidentX, incidentY);
            ctx.lineTo(centerX, centerY);
            ctx.strokeStyle = 'blue';
            ctx.lineWidth = 2;
            ctx.stroke();

            const reflected_X = centerX - rayLength * Math.cos(Math.PI / 2 + angle1Rad);
            const reflected_Y = centerY - rayLength * Math.sin(Math.PI / 2 + angle1Rad);

            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(reflected_X, reflected_Y);
            ctx.strokeStyle = 'red';
            ctx.lineWidth = totalInternalReflection ? 2 : 1; 
            ctx.setLineDash(totalInternalReflection ? [] : [3, 3]); 
            ctx.stroke();
            ctx.setLineDash([]); 

            if (!totalInternalReflection) {
                const refractedCanvasAngle = 3 * Math.PI / 2 + angle2Rad; 
                const refractedX = centerX + rayLength * Math.cos(Math.PI / 2 - angle2Rad);
                const refractedY = centerY + rayLength * Math.sin(Math.PI / 2 - angle2Rad);

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(refractedX, refractedY);
                ctx.strokeStyle = 'green';
                ctx.lineWidth = 2;
                ctx.stroke();
            } 

            ctx.beginPath();
            ctx.arc(centerX, centerY, 3, 0, 2 * Math.PI);
            ctx.fillStyle = '#000';
            ctx.fill();
        }
        
        // 초기 실행
        calculateAndDraw();

    </script>
</body>
</html>